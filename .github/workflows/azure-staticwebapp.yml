name: Build and Deploy to Azure Static Web Apps

on:
  push:
    branches:
      - main
  pull_request:
    types: [opened, synchronize, reopened, closed]
    branches:
      - main

env:
  # Angiv stien til din klientkode, relateret til roden af dit repository.
  APP_LOCATION: "Client" 
  # Angiv stien til din API kode, hvis den findes. Hvis ikke, sæt denne til "".
  API_LOCATION: "Server" 
  # Angiv stien til klientkodens build output. For Blazor-apps er det typisk 'wwwroot'.
  APP_ARTIFACT_LOCATION: "bin/Release/net7.0/wwwroot" 
  # Navnet på din Azure Static Web App.
  AZURE_STATIC_WEB_APP_NAME: "shittool" 
  # Deployment token for din Azure Static Web App. Gem denne værdi som en hemmelighed i din GitHub repo.
  AZURE_STATIC_WEB_APPS_API_TOKEN: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN }} 

jobs:
  build_and_deploy_job:
    if: github.event_name == 'push' || (github.event_name == 'pull_request' && github.event.action != 'closed')
    runs-on: ubuntu-latest
    name: Build and Deploy Job

    steps:
      - uses: actions/checkout@v3
        with:
          submodules: true # Hvis dit repository bruger submodules, skal dette være 'true'.

      - name: Setup .NET SDK
        uses: actions/setup-dotnet@v2
        with:
          dotnet-version: '7.0.x' # Den version af .NET SDK du bruger til at bygge din app.

      - name: Restore dependencies and build release
        run: |
          dotnet restore ${{env.APP_LOCATION}}
          dotnet build ${{env.APP_LOCATION}} --configuration Release --no-restore

      - name: Publish Release
        run: dotnet publish ${{env.APP_LOCATION}} --configuration Release --output ${{env.APP_ARTIFACT_LOCATION}}

      - name: Deploy to Azure Static Web Apps
        uses: Azure/static-web-apps-deploy@v1
        with:
          azure_static_web_apps_api_token: ${{env.AZURE_STATIC_WEB_APPS_API_TOKEN}}
          app_location: ${{env.APP_LOCATION}}
          api_location: ${{env.API_LOCATION}}
          app_artifact_location: ${{env.APP_ARTIFACT_LOCATION}}
          action: "upload"
